<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CubeSky Repo</title>
    <link rel="stylesheet" href="css/mdui.min.css">
    <script src="js/mdui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <style type="text/css">
    pre {
        font-family: "Courier 10 Pitch", Courier, monospace;
        font-size: 95%;
        line-height: 140%;
        white-space: pre;
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -o-pre-wrap;
    }       
    
    code {
        font-family: Monaco, Consolas, "Andale Mono", "DejaVu Sans Mono", monospace;
        font-size: 95%;
        line-height: 140%;
        white-space: pre;
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -o-pre-wrap;
    }
    
    #content code {
        display: block;
        padding: 0.5em 1em;
        border: 1px solid #bebab0;
    }
    </style>
</head>
<body class="mdui-theme-primary-indigo mdui-theme-accent-pink mdui-color-grey-200 mdui-appbar-with-toolbar mdui-appbar-with-tab">
  <div class="mdui-appbar mdui-appbar-fixed mdui-appbar-scroll-hide mdui-appbar-scroll-toolbar-hide">
    <div class="mdui-toolbar mdui-color-theme">
        <span class="mdui-typo-title">CubeSky Maven Repo</span>
        <div class="mdui-toolbar-spacer"></div>
    </div>
    <div class="mdui-tab mdui-color-theme mdui-tab-centered" mdui-tab>
      <a href="#tab-config" class="mdui-ripple mdui-ripple-white">Config</a>
      <a href="#tab-library" class="mdui-ripple mdui-ripple-white">Library</a>
    </div>
  </div>

    <div class="mdui-container mdui-appbar-with-toolbar">
      <div id="tab-config">
        <div class="mdui-row">
      <div class="mdui-col-xs-12">
        <div class="mdui-card">
          <div class="mdui-card-content">
          <h1>Gradle</h1>
          <div class="mdui-typo">
          <pre><code>
repositories {
    maven {
        url 'https://cubesky-mvn.github.io'
    }
}

dependencies {
    compile group: '${Group}', name: '${Name}', version: '${Version}'
}
        </code></pre>
        <button class="btncopy mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" id="gradle-install" data-clipboard-action="copy" data-clipboard-text><i class="mdui-icon mdui-icon-left material-icons">content_copy</i> 复制</button>
      </div>
        </div>
      </div>
  </div>
  </div>
  <div class="mdui-row">
      <div class="mdui-col-xs-12">
      <div class="mdui-card">
        <div class="mdui-card-content">
        <h1>Maven</h1>
        <div class="mdui-typo">
<pre><code>
&lt;repositories&gt;
  &lt;repository&gt;
    &lt;id&gt;cubesky-mvn&lt;/id&gt;
    &lt;name&gt;CubeSkyMVN&lt;/name&gt;
    &lt;url&gt;https://cubesky-mvn.github.io&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt; 

&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;${Group}&lt;/groupId&gt;
        &lt;artifactId&gt;${Name}&lt;/artifactId&gt;
        &lt;version&gt;${Version}&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<button class="btncopy mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent" id="maven-install" data-clipboard-action="copy" data-clipboard-text><i class="mdui-icon mdui-icon-left material-icons">content_copy</i> 复制</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="tab-library">
      <div class="mdui-row">
        <div class="mdui-col-xs-12">
          <h1>Supported Library</h1>
          <table class="mdui-table">
            <thead>
              <tr>
                <th>Group</th>
                <th>Name</th>
                <th>Latest Version</th>
                <th>Description</th>
                <th>Home Page</th>
                <th>Maven</th>
                <th>Gradle</th>
              </tr>
              <tbody id="library-list">
              </tbody>
            </thead>
          </table>
        </div>
      </div>
    </div>
  </div>
  <br>
  <script type="text/javascript">
        var $$ = mdui.JQ;
      const template=`
      <tr>
        <td>{group}</td>
        <td>{name}</td>
        <td>
          <select class="mdui-select" mdui-select data-lid="{lid}" data-name="{vname}" data-group="{vgroup}">
            {versions}
          </select>
        </td>
        <td>{description}</td>
        <td><a target="_black" href="{url}">{source}<i class="mdui-icon material-icons mdui-text-color-black-icon">open_in_new</i></a></td>
        <td><button class="btncopy mdui-btn mdui-btn-icon" data-clipboard-action="copy" data-clipboard-text="{maven}" id="lib-maven-{mlid}"><i class="mdui-icon material-icons">content_copy</i></button></td>
        <td><button class="btncopy mdui-btn mdui-btn-icon" data-clipboard-action="copy" data-clipboard-text="{gradle}" id="lib-gradle-{glid}"><i class="mdui-icon material-icons">content_copy</i></button></td>
      </tr>
      `;
      const template_version = `<option {def}>{version}</option>`;
      const template_maven = `
<dependencies>
  <dependency>
    <groupId>{group}</groupId>
    <artifactId>{name}</artifactId>
    <version>{version}</version>
  </dependency>
</dependencies>
`;
      const template_gradle = `compile group: '{group}', name: '{name}', version: '{version}'`;
      const maven_repo = `
<repositories>
  <repository>
    <id>cubesky-mvn</id>
    <name>CubeSkyMVN</name>
    <url>https://cubesky-mvn.github.io</url>
  </repository>
</repositories>
`;
      const gradle_repo = `
repositories {
    maven {
        url 'https://cubesky-mvn.github.io'
    }
}
`;
      const dataStore = [
      {group: 'party.liyin', name: 'socketchannel', url: 'https://github.com/cubesky/SocketChannel', description: 'Easy TCP/UDP transport', source: 'Github', version: ['1.0', '2.0', '2.1']}
      ];


      $$('#maven-install')[0].setAttribute('data-clipboard-text',maven_repo);
      $$('#gradle-install')[0].setAttribute('data-clipboard-text',gradle_repo);

      for (var i = 0; i < dataStore.length; i++) {
          var data = dataStore[i];
          var version = '';
          var latest = '';
          for (var i = 0; i < data.version.length; i++) {
            var ver = data.version[i];
            var def = '';
            if (i == data.version.length - 1){
              def = 'selected';
              latest = ver;
            }
            version += template_version.replace('{version}', ver).replace('{def}',def);
          }
          var gradle = template_gradle.replace('{group}', data.group).replace('{name}', data.name).replace('{version}', latest);
          var maven = template_maven.replace('{group}', data.group).replace('{name}', data.name).replace('{version}', latest);
          $$('#library-list')[0].innerHTML += (template.replace('{versions}', version).replace('{url}', data.url).replace('{group}', data.group).replace('{vgroup}', data.group).replace('{name}', data.name).replace('{vname}', data.name).replace('{description}', data.description).replace('{source}', data.source).replace('{gradle}', gradle).replace('{maven}', maven).replace('{lid}',i).replace('{glid}',i).replace('{mlid}',i));
      }

      var clipboard = new Clipboard('.btncopy');
      clipboard.on('success', function(e) {
        mdui.snackbar({ message: '已复制', position: 'right-top', timeout: 2500 });
        e.clearSelection();
      });

      clipboard.on('error', function(e) {
        mdui.snackbar({ message: '无法复制', position: 'right-top',  timeout: 2500 });
      });

      $$('.mdui-select').on('closed.mdui.select',function(target){
        console.log(target);
        var lid = target.target.dataset.lid;
        var name = target.target.dataset.name;
        var group = target.target.dataset.group;
        var version = target.target.value;
        var gradle = template_gradle.replace('{group}', group).replace('{name}', name).replace('{version}', version);
        var maven = template_maven.replace('{group}', group).replace('{name}', name).replace('{version}', version);
        $$('#lib-gradle-' + lid)[0].setAttribute('data-clipboard-text',gradle);
        $$('#lib-maven-' + lid)[0].setAttribute('data-clipboard-text',maven);
      })
  </script>
</body>
</html>